codes from master branch I changed this part totally
and this part
